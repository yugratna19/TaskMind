{% extends 'base.html' %}

{% block content %}
<h1 class="task-title">Task List</h1>

<!-- Display success messages -->
{% if messages %}
    <div class="alert alert-success">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>
{% endif %}

<!-- Search Bar Form -->
<form method="GET" action="{% url 'task_list' %}" class="search-form">
    <input type="text" name="search" class="search-input" placeholder="Search tasks..." value="{{ search_query }}">
    <button type="submit" class="btn search-btn">Search</button>
</form>

<!-- Filter by Status -->
<form method="GET" action="{% url 'task_list' %}" class="filter-form">
    <label for="status">Filter by Status:</label>
    <select name="status" id="status" onchange="this.form.submit()">
        <option value="">All</option>
        <option value="Not Completed" {% if status_filter == 'Not Completed' %}selected{% endif %}>Not Completed</option>
        <option value="Completed" {% if status_filter == 'Completed' %}selected{% endif %}>Completed</option>
    </select>
</form>

<!-- Task List -->
<div class="task-container">
    {% for task in page_obj %}
        <div class="task-card">
            <a href="{% url 'task_details' task.id %}" class="task-link">
                <h3 class="task-title">{{ task.title }}</h3>
            </a>
            <p class="task-details">
                <span class="task-due">Due: {{ task.due_date }}</span> | 
                <span class="task-status">Status: {{ task.get_status_display }}</span>
            </p>
        </div>
    {% empty %}
        <div class="task-card no-tasks">
            <p>No tasks found.</p>
        </div>
    {% endfor %}
</div>

<!-- Pagination Controls -->
<div>
    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.</span>
    <div>
        {% if page_obj.has_previous %}
            <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">First</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">Previous</a>
        {% endif %}
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">Next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">Last</a>
        {% endif %}
    </div>
</div>

{% endblock %}
